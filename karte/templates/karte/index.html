{% load leaflet_tags %}
<html>
  <head>
    {% leaflet_js %}
    {% leaflet_css %}
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <style>
        .leaflet-container { height: 100%; }
    </style>
  </head>
  <body>
    {% leaflet_map "main" callback="main_map_init" %}

    <script type="text/javascript">
        function main_map_init (map, options) {
            var controller = L.control.layers().addTo(map);
            {% for tour in touren %}
                var orte_url = '{% url "orte_tour" tour.name %}';
                $.getJSON(orte_url, function(data) {
                    var layer = L.geoJson(data);
                    layer.addTo(map);
                    controller.addOverlay(layer, '{{ tour.name|safe }}');
                });
            {% endfor %}

            {% for tour in touren %}
                var track_url = '{% url "track_tour" tour.name %}';
                $.getJSON(track_url, function(data) {
                    var layer = L.geoJson(data);
                    layer.addTo(map);
                    controller.addOverlay(layer, '{{ tour.name|safe }}');
                });
            {% endfor %}
        }
    </script>

  </body>
</html>
